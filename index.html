<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Institucional - ANAM</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#611232">

<style>
body{
margin:0;
font-family:Arial, Helvetica, sans-serif;
background:#F4F4F4;
color:#161A1D;
}

/* BARRA SUPERIOR */
.top-bar{
background:#611232;
color:#fff;
padding:12px 20px;
font-size:14px;
font-weight:bold;
}

/* ENCABEZADO */
.header{
background:#fff;
text-align:center;
padding:25px 20px;
border-bottom:4px solid #A57F2C;
}

.logo{
max-width:260px;
height:auto;
}

.title{
color:#611232;
font-size:22px;
font-weight:bold;
margin-top:10px;
}

/* CONTENEDOR */
.container{
background:#fff;
max-width:750px;
margin:30px auto;
padding:30px;
border-radius:8px;
box-shadow:0 6px 14px rgba(0,0,0,0.08);
border-top:8px solid #1E5B4F;
}

h3{
color:#611232;
border-bottom:2px solid #A57F2C;
padding-bottom:8px;
}

label{font-weight:bold}

select,input,textarea{
width:100%;
padding:10px;
margin:8px 0 18px;
border-radius:4px;
border:1px solid #ccc;
}

select:focus,input:focus,textarea:focus{
outline:none;
border-color:#1E5B4F;
box-shadow:0 0 4px rgba(30,91,79,0.3);
}

#placas{text-transform:uppercase}

button{
background:#1E5B4F;
color:#fff;
padding:12px;
border:none;
width:100%;
border-radius:4px;
font-size:16px;
cursor:pointer;
font-weight:bold;
}

button:hover{background:#17463D}
button:disabled{background:#98989A}

.hidden{display:none}

/* MODAL */
.modal{
display:none;
position:fixed;
inset:0;
background:rgba(0,0,0,.5);
justify-content:center;
align-items:center;
}

.modal-content{
background:#fff;
padding:25px;
border-radius:8px;
max-width:400px;
width:90%;
text-align:center;
border-top:6px solid #611232;
}

.footer{
text-align:center;
font-size:12px;
color:#98989A;
margin:30px 0;
}
</style>
</head>
<body>

<div class="top-bar">
Gobierno de México | Agencia Nacional de Aduanas de México
</div>

<div class="header">
<img src="logo-anam.png" class="logo">
<div class="title">Sistema Institucional de Módulos Retornos</div>
</div>

<div class="container">

<h3>Generador de Solicitudes</h3>

<p><strong>Folio:</strong> <span id="folio">--</span></p>
<p><strong>Fecha:</strong> <span id="fechaHora"></span></p>

<form id="formRetorno">

<label>Tipo de Operación</label>
<select id="operacion" required>
<option>IMPORTACION</option>
<option selected>EXPORTACION</option>
</select>

<label>Operador</label>
<input type="text" id="operador" required>

<label>Tipo de Solicitud</label>
<select id="tipo" required>
<option selected>Retorno Para Nueva Exploración</option>
<option>Retorno Fuera De Horario</option>
<option>Retorno Sin Servicio Extraordinario</option>
<option>Retorno Por Equivocación de Carril</option>
<option>Solicitud de Revisión De Mercancía Sobre-Dimensionada</option>
</select>

<label>Placas</label>
<textarea id="placas" required></textarea>

<div id="mercanciaDiv" class="hidden">
<label>Mercancía</label>
<textarea id="mercancia"></textarea>
</div>

<button type="submit" id="btnEnviar" disabled>Generar Correo</button>

</form>
</div>

<div class="footer">
© 2026 Agencia Nacional de Aduanas de México
</div>

<!-- MODAL -->
<div id="selectorModal" class="modal">
<div class="modal-content">
<h3>¿Cómo deseas enviar el correo?</h3>
<button onclick="enviarCorreo('app')">Abrir App de Outlook</button>
<button onclick="enviarCorreo('web')">Abrir Outlook Web</button>
<button onclick="cerrarModal()">Cancelar</button>
</div>
</div>

<script>

if('serviceWorker' in navigator){
navigator.serviceWorker.register('service-worker.js');
}

const form=document.getElementById("formRetorno");
const btnEnviar=document.getElementById("btnEnviar");
const tipo=document.getElementById("tipo");
const placas=document.getElementById("placas");
const mercanciaDiv=document.getElementById("mercanciaDiv");
const mercancia=document.getElementById("mercancia");
const operador=document.getElementById("operador");
const operacion=document.getElementById("operacion");
const modal=document.getElementById("selectorModal");

let cuerpoCorreo="";
let asuntoCorreo="";

function actualizarFecha(){
document.getElementById("fechaHora").textContent=new Date().toLocaleString();
}
actualizarFecha();
setInterval(actualizarFecha,1000);

function validar(){
btnEnviar.disabled=!form.checkValidity();
}
form.addEventListener("input",validar);
form.addEventListener("change",validar);

placas.addEventListener("input",function(){
this.value=this.value.toUpperCase();
});

tipo.addEventListener("change",()=>{
if(tipo.value==="Solicitud de Revisión De Mercancía Sobre-Dimensionada"){
mercanciaDiv.classList.remove("hidden");
mercancia.required=true;
}else{
mercanciaDiv.classList.add("hidden");
mercancia.required=false;
}
validar();
});

function generarFolio(){
const hoy=new Date();
const base=hoy.getFullYear().toString()+
("0"+(hoy.getMonth()+1)).slice(-2)+
("0"+hoy.getDate()).slice(-2);
let contador=localStorage.getItem("folio_"+base);
contador=contador?parseInt(contador)+1:1;
localStorage.setItem("folio_"+base,contador);
return `RET-${base}-${String(contador).padStart(3,'0')}`;
}

form.addEventListener("submit",function(e){
e.preventDefault();
if(!form.checkValidity()) return;

const folio=generarFolio();
document.getElementById("folio").textContent=folio;

cuerpoCorreo=
"FOLIO: "+folio+"\n"+
"Fecha: "+document.getElementById("fechaHora").textContent+"\n"+
"Operación: "+operacion.value+"\n"+
"Operador: "+operador.value+"\n\n"+
"Tipo:\n"+tipo.value+"\n\n"+
"Placas:\n"+placas.value;

if(!mercanciaDiv.classList.contains("hidden")){
cuerpoCorreo+="\n\nMercancía:\n"+mercancia.value;
}

asuntoCorreo=operacion.value+" - "+tipo.value;

modal.style.display="flex";
});

function enviarCorreo(metodo){

cerrarModal();

const to="jorge.silva@anam.gob.mx,vyc.altamira@anam.gob.mx,alejandra.munoz@anam.gob.mx,nayely.chavez@anam.gob.mx,miguel.herrera@anam.gob.mx,abraham.gomez@anam.gob.mx,daniel.santosh@anam.gob.mx,christian.monrreal@anam.gob.mx,monica.becerra@anam.gob.mx,anahi.santiago@anam.gob.mx";

const subject=encodeURIComponent(asuntoCorreo);
const body=encodeURIComponent(cuerpoCorreo);

if(metodo==="web"){
window.open("https://outlook.office.com/mail/deeplink/compose?to="+to+"&subject="+subject+"&body="+body,"_blank");
}

if(metodo==="app"){
window.location.href="mailto:"+to+"?subject="+subject+"&body="+body;
}

form.reset();
validar();
}

function cerrarModal(){
modal.style.display="none";
}

validar();

</script>

</body>
</html>
